{"componentChunkName":"component---src-pages-developer-advanced-2-devsecops-trivy-index-mdx","path":"/developer-advanced-2/devsecops-trivy/","result":{"pageContext":{"frontmatter":{"title":"DevSecOps with Trivy"},"relativePagePath":"/developer-advanced-2/devsecops-trivy/index.mdx","titleType":"page","MdxNode":{"id":"eadb3e21-a232-520f-8a20-f71d871bd52d","children":[],"parent":"9bb53e83-2b6c-5a71-840d-6488618bb406","internal":{"content":"---\ntitle: DevSecOps with Trivy\n---\n\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\n\n<PageDescription>\nAquasec Trivy\n</PageDescription>\n\n## Overview\n\nTrivy is an open-source tool from Aqua Security to scan container images for vulnerabilities.Â Trivy is a simple and comprehensive vulnerability scanner.\n\nTrivy can detects vulnerabilities of operating systems packages (CentOS, RHEL, Alpine and etc.) and application dependencies (npm, yarn, Composer, etc). Trivy is easy to use. Just install the binary and start the scanning by specifying the target such as an image name of the container.\n\nIt is now available as an integrated option within a number of platforms. Trivy is also integrated into the Tekton pipeline of Cloud-Native Toolkit.\n\nWith the frequent feature and vulnerability database updates and its comprehensive vulnerability scanning, trivy brings in the higher levels of usability and performance.\n\nTrivy is highly used in Continuous-Integration. Before pushing image and other artifacts to a registry or deploying your application, You can scan them easily.\n\n## Features\n\n#### Easy install\n* No pre-requisites such as installation of DB, libraries, etc\n* apt-get install, yum install and brew install options are available for quick installation\n\n#### Simple\n* Specify only an image name or artifact name.\n\n#### Fast\n* The first scan will finish within 10 seconds (depending on your network). Consequent scans will finish in few seconds.\n\n#### Detect comprehensive vulnerabilities\n* OS packages (Alpine, Red Hat Universal Base Image, Red Hat Enterprise Linux, CentOS, Oracle Linux, Debian, Ubuntu, Amazon Linux, openSUSE Leap, SUSE Enterprise Linux, Photon OS and Distroless)\n* Application dependencies (Bundler, Composer, Pipenv, Poetry, npm, yarn and Cargo)\n\n#### High accuracy\n* Especially Alpine Linux and RHEL/CentOS\n* Other OSes are also high\n\n#### DevSecOps\n* Suitable for CI such as Travis CI, CircleCI, Jenkins, GitLab CI, etc.\n\nThanks to https://github.com/aquasecurity/trivy\n\n\n## Artifacts scanned by Trivy\n\nTrivy can scan the following type of artifacts.\n\n#### Image\nTrivy can scan container images from the repository.\n\n  ex: trivy image python:3.4-alpine\n\n#### Filesystem\nTrivy can go through filesystems such as\n* host machine\n* a virtual machine image \n* unpacked container image filesystem \n\nBy going through the filesystems it can find and scan the following.\n* Image file as tar (ex: trivy image --input ruby-2.3.0.tar)\n* OCI image (ex: trivy image --input /path/to/alpine)\n* Project containing lock files (ex. Gemfile.lock and package-lock.json)\n\n#### Git Repository\nTrivy can scan your remote git repository for OS Packages.\n\nex: trivy repo https://github.com/knqyf263/trivy-ci-test\n\n#### Embed in Dockerfile\nTrivy can scan your image as part of the build process when Trivy is embedded in the Dockerfile. \n\n\n\n## Installation\nTrivy installation is very simple. You can use homebrew on macOS to install.\n\n```\n$ brew install aquasecurity/trivy/trivy\n```\n\n\n## How to scan with Trivy\n\n### Basic Scan\n\nJust by specifying image name you can kickstart the scanning. In the below example `python:3.4-alpine` is scanned.\n\n```\n$ trivy image [YOUR_IMAGE_NAME]\n\n\n$ trivy image python:3.4-alpine\n```\n\nOutput\n```\n2020-06-23T23:11:07.297+0530\tINFO\tDetecting Alpine vulnerabilities...\n\npython:3.4-alpine (alpine 3.9.2)\n================================\nTotal: 15 (UNKNOWN: 0, LOW: 1, MEDIUM: 10, HIGH: 4, CRITICAL: 0)\n\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| LIBRARY | VULNERABILITY ID | SEVERITY | INSTALLED VERSION | FIXED VERSION |             TITLE              |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| bzip2   | CVE-2019-12900   | HIGH     | 1.0.6-r6          | 1.0.6-r7      | bzip2: out-of-bounds write in  |\n|         |                  |          |                   |               | function BZ2_decompress        |\n+---------+------------------+          +-------------------+---------------+--------------------------------+\n| expat   | CVE-2018-20843   |          | 2.2.6-r0          | 2.2.7-r0      | expat: large number of colons  |\n|         |                  |          |                   |               | in input makes parser consume  |\n|         |                  |          |                   |               | high amount...                 |\n+         +------------------+----------+                   +---------------+--------------------------------+\n|         | CVE-2019-15903   | MEDIUM   |                   | 2.2.7-r1      | expat: heap-based buffer       |\n|         |                  |          |                   |               | over-read via crafted XML      |\n|         |                  |          |                   |               | input                          |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| musl    | CVE-2019-14697   | HIGH     | 1.1.20-r4         | 1.1.20-r5     | musl libc through 1.1.23       |\n|         |                  |          |                   |               | has an x87 floating-point      |\n|         |                  |          |                   |               | stack adjustment imbalance,    |\n|         |                  |          |                   |               | related...                     |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| openssl | CVE-2019-1543    | MEDIUM   | 1.1.1a-r1         | 1.1.1b-r1     | openssl: ChaCha20-Poly1305     |\n|         |                  |          |                   |               | with long nonces               |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-1549    |          |                   | 1.1.1d-r0     | openssl: information           |\n|         |                  |          |                   |               | disclosure in fork()           |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-1551    |          |                   | 1.1.1d-r2     | openssl: Integer overflow in   |\n|         |                  |          |                   |               | RSAZ modular exponentiation on |\n|         |                  |          |                   |               | x86_64                         |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-1563    |          |                   | 1.1.1d-r0     | openssl: information           |\n|         |                  |          |                   |               | disclosure in PKCS7_dataDecode |\n|         |                  |          |                   |               | and CMS_decrypt_set1_pkey      |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2020-1967    |          |                   | 1.1.1g-r0     | openssl: Segmentation fault in |\n|         |                  |          |                   |               | SSL_check_chain causes denial  |\n|         |                  |          |                   |               | of service                     |\n+         +------------------+----------+                   +---------------+--------------------------------+\n|         | CVE-2019-1547    | LOW      |                   | 1.1.1d-r0     | openssl: side-channel weak     |\n|         |                  |          |                   |               | encryption vulnerability       |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| sqlite  | CVE-2019-8457    | HIGH     | 3.26.0-r3         | 3.28.0-r0     | sqlite: heap out-of-bound read |\n|         |                  |          |                   |               | in function rtreenode()        |\n+         +------------------+----------+                   +---------------+--------------------------------+\n|         | CVE-2019-16168   | MEDIUM   |                   | 3.28.0-r1     | sqlite: division by zero in    |\n|         |                  |          |                   |               | whereLoopAddBtreeIndex in      |\n|         |                  |          |                   |               | sqlite3.c                      |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-19242   |          |                   | 3.28.0-r2     | sqlite: SQL injection in       |\n|         |                  |          |                   |               | sqlite3ExprCodeTarget in       |\n|         |                  |          |                   |               | expr.c                         |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-5018    |          |                   | 3.28.0-r0     | sqlite: use-after-free in      |\n|         |                  |          |                   |               | window function leading to     |\n|         |                  |          |                   |               | remote code execution          |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2020-11655   |          |                   | 3.28.0-r3     | sqlite: malformed              |\n|         |                  |          |                   |               | window-function query leads to |\n|         |                  |          |                   |               | DoS                            |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n```\n\n\n### Filter vulnerabilities by severities\n\nVulnerability results can be filtered. In the below example HIGH and CRITICAL issues are displayed\n\n```\n$ trivy image --severity HIGH,CRITICAL python:3.4-alpine\n```\n\n```\n\npython:3.4-alpine (alpine 3.9.2)\n================================\nTotal: 4 (UNKNOWN: 0, LOW: 0, MEDIUM: 0, HIGH: 4, CRITICAL: 0)\n\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| LIBRARY | VULNERABILITY ID | SEVERITY | INSTALLED VERSION | FIXED VERSION |             TITLE              |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| bzip2   | CVE-2019-12900   | HIGH     | 1.0.6-r6          | 1.0.6-r7      | bzip2: out-of-bounds write in  |\n|         |                  |          |                   |               | function BZ2_decompress        |\n+---------+------------------+          +-------------------+---------------+--------------------------------+\n| expat   | CVE-2018-20843   |          | 2.2.6-r0          | 2.2.7-r0      | expat: large number of colons  |\n|         |                  |          |                   |               | in input makes parser consume  |\n|         |                  |          |                   |               | high amount...                 |\n+---------+------------------+          +-------------------+---------------+--------------------------------+\n| musl    | CVE-2019-14697   |          | 1.1.20-r4         | 1.1.20-r5     | musl libc through 1.1.23       |\n|         |                  |          |                   |               | has an x87 floating-point      |\n|         |                  |          |                   |               | stack adjustment imbalance,    |\n|         |                  |          |                   |               | related...                     |\n+---------+------------------+          +-------------------+---------------+--------------------------------+\n| sqlite  | CVE-2019-8457    |          | 3.26.0-r3         | 3.28.0-r0     | sqlite: heap out-of-bound read |\n|         |                  |          |                   |               | in function rtreenode()        |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n```\n\n### Filter vulnerabilities by type\n\nTrivy output can be generated as json.\n\n```\n$ trivy image --vuln-type os ruby:2.4.0\n```\n\nTypes can be `os` or `library`\n\n### Trivy Results as JSON\n\nTrivy output can be generated as json.\n\n```\n$ trivy image -f json -o results.json python:3.4-alpine\n```\n\n\n\n\n## CI with Trivy\n\nAs part of the Continuous Integration pipeline you can scan your image using the Trivy. The pipeline can be continued or stopped based on the vulnerabilities detected. To stop the pipeline `--exit-code 1` to be used.\n\nSo exit-code is used to break the pipeline based on vulnerability findings.\n\n#### Continue pipeline\n\nIn the below example the Pipeline will continue, when MEDIUM and LOW severities found.\n\n```\n$ trivy image --exit-code 0 --severity MEDIUM,LOW python:3.4-alpine\n```\n\n#### Stop pipeline\n\nIn the below example the Pipeline stops, when CRITICAL and HIGH severities found.\n\n```\n$ trivy image --exit-code 1 --severity CRITICAL,HIGH python:3.4-alpine\n```\n\n\n## Trivy Scan in Cloud-Native Toolkit\n\nTrivy scan is available as part of the Cloud-Native Toolkit Tekton pipeline. \n\nThe pipeline scripts are available at https://github.com/IBM/ibm-garage-tekton-tasks/\n\n### Pipeline\n\nHere is the tekton pipeline of the toolkit. Here `Trivy scan` task is placed in between `build` and `deploy` to make sure the image is scanned before it is deployed in the cluster for health check and so on.\n\n ![Cloud-Native Toolkit Pipeline ](/images/1-pipeline-tasks.png \"Cloud-Native Toolkit Pipeline\")\n\nLets us explore in detail about the trivy-scan task.\n\n### Pipeline Tasks\n\nPipeline contains list of tasks.\n\n![Cloud-Native Toolkit Pipeline ](/images/2-pipeline.png \"Cloud-Native Toolkit Pipeline\")\n\nLine no. 50: Shows `build` task \n\nLine no. 70: Shows `trivy-scan` task, which runs after `build` (line no 74).\n\nLine no. 80: Shows `deploy` task, which runs after `trivy-scan` (line no 84).\n\n### Task : build\n\nThe build task executes the logic to build a container image, tag it and push it to a local container image repository (Ex: image-registry.openshift-image-registry.svc:5000/dev-g2/dev-g-trivy6:605b0ec).\n\nHere `Buildah` tool is used to build, tag and push the the container image.  Buildah is a tool that facilitates building Open Container Initiative (OCI) container images.\n\n![Cloud-Native Toolkit Pipeline ](/images/3-task-build.png \"Cloud-Native Toolkit Pipeline\")\n\nLine no. 102: Shows buildah is login into local container registry\n\nLine no. 106: Shows buildah is pushing image to the local container registry. Given below the buildah push with variables substituted with values.\n\n```\n+ buildah --storage-driver=overlay push --tls-verify=false --digestfile ./image-digest image-registry.openshift-image-registry.svc:5000/dev-g2/dev-g-trivy6:605b0ec docker://image-registry.openshift-image-registry.svc:5000/dev-g2/dev-g-trivy6:605b0ec\n```\n\n### Task: trivy-scan \n\nTrivy-Scan task contains 2 steps. The steps are `Pull-image` and `Scan-image`. Lets see them in detail in the below sections.\n\nhttps://github.com/IBM/ibm-garage-tekton-tasks/blob/master/tasks/3-img-scan-trivy.yaml\n\n![Cloud-Native Toolkit Pipeline ](/images/4-task-scan-1.png \"Cloud-Native Toolkit Pipeline\")\n\nLine no. 29: Shows `pull-image` step\n\nLine no. 71: Shows `scan-image` step\n\n\n### Step: pull-image \n\nThis step will pull the image from the local container registry (which was built in the previous task) and store it in the OCI image directory. \n\nHere `skopeo` tool is used to the copy the image from local container registry to OCI image directory. Skopeo is a command line utility that performs various operations on container images and image repositories such as Copying an image from and to various storage mechanisms, Inspecting a remote image,  Deleting an image from an image repository and etc.\n\nThere is an option to skip this scan. When the flag `params.scan-image` is set to false then this can will be skipped.\n\n![Cloud-Native Toolkit Pipeline ](/images/5-task-scan-2.png \"Cloud-Native Toolkit Pipeline\")\n\nLine no. 70: skopeo copies the image from local container registry to OCI image directory. Given below the skopeo copy command with variables substituted with values. Here image is copied to `oci:/var/oci/image`.\n\n```\nskopeo copy --src-creds=xxxx --src-tls-verify=false docker://image-registry.openshift-image-registry.svc:5000/dev-g2/dev-g-trivy6:605b0ec oci:/var/oci/image\n```\n\n\n### Step : scan-image\n\nThis step runs an image scan with Trivy and fails the pipeline if issues are found.\n\nIn the previous step the image is copied to the OCI image directory `oci:/var/oci/image`. The variable `PATH_TO_IMAGE` would be pointing to this OCI image directory. This `PATH_TO_IMAGE` is passed to the trivy scan (line no 80 and 81). \n\nThe trivy scanning is done and `--exit-code` would be set according to the scan results. Based on the `--exit-code` pipeline will be continued or stopped.\n\n ![Cloud-Native Toolkit Pipeline ](/images/6-task-scan-3.png \"Cloud-Native Toolkit Pipeline\")\n\nLine no. 80: Trivy scan is done and it print all the vulnerabilities found in the image.\n\nLine no. 81: Trivy scan is done and it print all the CRITICAL vulnerabilities found in the image. \n\nLine no. 84: Checks if any CRITICAL vulnerabilities found, based on the `--exit-code` from line no. 81.\n\nLine no. 86: Exits the pipeline when CRITICAL vulnerabilities found.\n\n","type":"Mdx","contentDigest":"f2d2ca41e0f5126f38c69ab24fde439c","owner":"gatsby-plugin-mdx","counter":980},"frontmatter":{"title":"DevSecOps with Trivy"},"exports":{},"rawBody":"---\ntitle: DevSecOps with Trivy\n---\n\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\n\n<PageDescription>\nAquasec Trivy\n</PageDescription>\n\n## Overview\n\nTrivy is an open-source tool from Aqua Security to scan container images for vulnerabilities.Â Trivy is a simple and comprehensive vulnerability scanner.\n\nTrivy can detects vulnerabilities of operating systems packages (CentOS, RHEL, Alpine and etc.) and application dependencies (npm, yarn, Composer, etc). Trivy is easy to use. Just install the binary and start the scanning by specifying the target such as an image name of the container.\n\nIt is now available as an integrated option within a number of platforms. Trivy is also integrated into the Tekton pipeline of Cloud-Native Toolkit.\n\nWith the frequent feature and vulnerability database updates and its comprehensive vulnerability scanning, trivy brings in the higher levels of usability and performance.\n\nTrivy is highly used in Continuous-Integration. Before pushing image and other artifacts to a registry or deploying your application, You can scan them easily.\n\n## Features\n\n#### Easy install\n* No pre-requisites such as installation of DB, libraries, etc\n* apt-get install, yum install and brew install options are available for quick installation\n\n#### Simple\n* Specify only an image name or artifact name.\n\n#### Fast\n* The first scan will finish within 10 seconds (depending on your network). Consequent scans will finish in few seconds.\n\n#### Detect comprehensive vulnerabilities\n* OS packages (Alpine, Red Hat Universal Base Image, Red Hat Enterprise Linux, CentOS, Oracle Linux, Debian, Ubuntu, Amazon Linux, openSUSE Leap, SUSE Enterprise Linux, Photon OS and Distroless)\n* Application dependencies (Bundler, Composer, Pipenv, Poetry, npm, yarn and Cargo)\n\n#### High accuracy\n* Especially Alpine Linux and RHEL/CentOS\n* Other OSes are also high\n\n#### DevSecOps\n* Suitable for CI such as Travis CI, CircleCI, Jenkins, GitLab CI, etc.\n\nThanks to https://github.com/aquasecurity/trivy\n\n\n## Artifacts scanned by Trivy\n\nTrivy can scan the following type of artifacts.\n\n#### Image\nTrivy can scan container images from the repository.\n\n  ex: trivy image python:3.4-alpine\n\n#### Filesystem\nTrivy can go through filesystems such as\n* host machine\n* a virtual machine image \n* unpacked container image filesystem \n\nBy going through the filesystems it can find and scan the following.\n* Image file as tar (ex: trivy image --input ruby-2.3.0.tar)\n* OCI image (ex: trivy image --input /path/to/alpine)\n* Project containing lock files (ex. Gemfile.lock and package-lock.json)\n\n#### Git Repository\nTrivy can scan your remote git repository for OS Packages.\n\nex: trivy repo https://github.com/knqyf263/trivy-ci-test\n\n#### Embed in Dockerfile\nTrivy can scan your image as part of the build process when Trivy is embedded in the Dockerfile. \n\n\n\n## Installation\nTrivy installation is very simple. You can use homebrew on macOS to install.\n\n```\n$ brew install aquasecurity/trivy/trivy\n```\n\n\n## How to scan with Trivy\n\n### Basic Scan\n\nJust by specifying image name you can kickstart the scanning. In the below example `python:3.4-alpine` is scanned.\n\n```\n$ trivy image [YOUR_IMAGE_NAME]\n\n\n$ trivy image python:3.4-alpine\n```\n\nOutput\n```\n2020-06-23T23:11:07.297+0530\tINFO\tDetecting Alpine vulnerabilities...\n\npython:3.4-alpine (alpine 3.9.2)\n================================\nTotal: 15 (UNKNOWN: 0, LOW: 1, MEDIUM: 10, HIGH: 4, CRITICAL: 0)\n\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| LIBRARY | VULNERABILITY ID | SEVERITY | INSTALLED VERSION | FIXED VERSION |             TITLE              |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| bzip2   | CVE-2019-12900   | HIGH     | 1.0.6-r6          | 1.0.6-r7      | bzip2: out-of-bounds write in  |\n|         |                  |          |                   |               | function BZ2_decompress        |\n+---------+------------------+          +-------------------+---------------+--------------------------------+\n| expat   | CVE-2018-20843   |          | 2.2.6-r0          | 2.2.7-r0      | expat: large number of colons  |\n|         |                  |          |                   |               | in input makes parser consume  |\n|         |                  |          |                   |               | high amount...                 |\n+         +------------------+----------+                   +---------------+--------------------------------+\n|         | CVE-2019-15903   | MEDIUM   |                   | 2.2.7-r1      | expat: heap-based buffer       |\n|         |                  |          |                   |               | over-read via crafted XML      |\n|         |                  |          |                   |               | input                          |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| musl    | CVE-2019-14697   | HIGH     | 1.1.20-r4         | 1.1.20-r5     | musl libc through 1.1.23       |\n|         |                  |          |                   |               | has an x87 floating-point      |\n|         |                  |          |                   |               | stack adjustment imbalance,    |\n|         |                  |          |                   |               | related...                     |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| openssl | CVE-2019-1543    | MEDIUM   | 1.1.1a-r1         | 1.1.1b-r1     | openssl: ChaCha20-Poly1305     |\n|         |                  |          |                   |               | with long nonces               |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-1549    |          |                   | 1.1.1d-r0     | openssl: information           |\n|         |                  |          |                   |               | disclosure in fork()           |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-1551    |          |                   | 1.1.1d-r2     | openssl: Integer overflow in   |\n|         |                  |          |                   |               | RSAZ modular exponentiation on |\n|         |                  |          |                   |               | x86_64                         |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-1563    |          |                   | 1.1.1d-r0     | openssl: information           |\n|         |                  |          |                   |               | disclosure in PKCS7_dataDecode |\n|         |                  |          |                   |               | and CMS_decrypt_set1_pkey      |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2020-1967    |          |                   | 1.1.1g-r0     | openssl: Segmentation fault in |\n|         |                  |          |                   |               | SSL_check_chain causes denial  |\n|         |                  |          |                   |               | of service                     |\n+         +------------------+----------+                   +---------------+--------------------------------+\n|         | CVE-2019-1547    | LOW      |                   | 1.1.1d-r0     | openssl: side-channel weak     |\n|         |                  |          |                   |               | encryption vulnerability       |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| sqlite  | CVE-2019-8457    | HIGH     | 3.26.0-r3         | 3.28.0-r0     | sqlite: heap out-of-bound read |\n|         |                  |          |                   |               | in function rtreenode()        |\n+         +------------------+----------+                   +---------------+--------------------------------+\n|         | CVE-2019-16168   | MEDIUM   |                   | 3.28.0-r1     | sqlite: division by zero in    |\n|         |                  |          |                   |               | whereLoopAddBtreeIndex in      |\n|         |                  |          |                   |               | sqlite3.c                      |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-19242   |          |                   | 3.28.0-r2     | sqlite: SQL injection in       |\n|         |                  |          |                   |               | sqlite3ExprCodeTarget in       |\n|         |                  |          |                   |               | expr.c                         |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2019-5018    |          |                   | 3.28.0-r0     | sqlite: use-after-free in      |\n|         |                  |          |                   |               | window function leading to     |\n|         |                  |          |                   |               | remote code execution          |\n+         +------------------+          +                   +---------------+--------------------------------+\n|         | CVE-2020-11655   |          |                   | 3.28.0-r3     | sqlite: malformed              |\n|         |                  |          |                   |               | window-function query leads to |\n|         |                  |          |                   |               | DoS                            |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n```\n\n\n### Filter vulnerabilities by severities\n\nVulnerability results can be filtered. In the below example HIGH and CRITICAL issues are displayed\n\n```\n$ trivy image --severity HIGH,CRITICAL python:3.4-alpine\n```\n\n```\n\npython:3.4-alpine (alpine 3.9.2)\n================================\nTotal: 4 (UNKNOWN: 0, LOW: 0, MEDIUM: 0, HIGH: 4, CRITICAL: 0)\n\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| LIBRARY | VULNERABILITY ID | SEVERITY | INSTALLED VERSION | FIXED VERSION |             TITLE              |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n| bzip2   | CVE-2019-12900   | HIGH     | 1.0.6-r6          | 1.0.6-r7      | bzip2: out-of-bounds write in  |\n|         |                  |          |                   |               | function BZ2_decompress        |\n+---------+------------------+          +-------------------+---------------+--------------------------------+\n| expat   | CVE-2018-20843   |          | 2.2.6-r0          | 2.2.7-r0      | expat: large number of colons  |\n|         |                  |          |                   |               | in input makes parser consume  |\n|         |                  |          |                   |               | high amount...                 |\n+---------+------------------+          +-------------------+---------------+--------------------------------+\n| musl    | CVE-2019-14697   |          | 1.1.20-r4         | 1.1.20-r5     | musl libc through 1.1.23       |\n|         |                  |          |                   |               | has an x87 floating-point      |\n|         |                  |          |                   |               | stack adjustment imbalance,    |\n|         |                  |          |                   |               | related...                     |\n+---------+------------------+          +-------------------+---------------+--------------------------------+\n| sqlite  | CVE-2019-8457    |          | 3.26.0-r3         | 3.28.0-r0     | sqlite: heap out-of-bound read |\n|         |                  |          |                   |               | in function rtreenode()        |\n+---------+------------------+----------+-------------------+---------------+--------------------------------+\n```\n\n### Filter vulnerabilities by type\n\nTrivy output can be generated as json.\n\n```\n$ trivy image --vuln-type os ruby:2.4.0\n```\n\nTypes can be `os` or `library`\n\n### Trivy Results as JSON\n\nTrivy output can be generated as json.\n\n```\n$ trivy image -f json -o results.json python:3.4-alpine\n```\n\n\n\n\n## CI with Trivy\n\nAs part of the Continuous Integration pipeline you can scan your image using the Trivy. The pipeline can be continued or stopped based on the vulnerabilities detected. To stop the pipeline `--exit-code 1` to be used.\n\nSo exit-code is used to break the pipeline based on vulnerability findings.\n\n#### Continue pipeline\n\nIn the below example the Pipeline will continue, when MEDIUM and LOW severities found.\n\n```\n$ trivy image --exit-code 0 --severity MEDIUM,LOW python:3.4-alpine\n```\n\n#### Stop pipeline\n\nIn the below example the Pipeline stops, when CRITICAL and HIGH severities found.\n\n```\n$ trivy image --exit-code 1 --severity CRITICAL,HIGH python:3.4-alpine\n```\n\n\n## Trivy Scan in Cloud-Native Toolkit\n\nTrivy scan is available as part of the Cloud-Native Toolkit Tekton pipeline. \n\nThe pipeline scripts are available at https://github.com/IBM/ibm-garage-tekton-tasks/\n\n### Pipeline\n\nHere is the tekton pipeline of the toolkit. Here `Trivy scan` task is placed in between `build` and `deploy` to make sure the image is scanned before it is deployed in the cluster for health check and so on.\n\n ![Cloud-Native Toolkit Pipeline ](/images/1-pipeline-tasks.png \"Cloud-Native Toolkit Pipeline\")\n\nLets us explore in detail about the trivy-scan task.\n\n### Pipeline Tasks\n\nPipeline contains list of tasks.\n\n![Cloud-Native Toolkit Pipeline ](/images/2-pipeline.png \"Cloud-Native Toolkit Pipeline\")\n\nLine no. 50: Shows `build` task \n\nLine no. 70: Shows `trivy-scan` task, which runs after `build` (line no 74).\n\nLine no. 80: Shows `deploy` task, which runs after `trivy-scan` (line no 84).\n\n### Task : build\n\nThe build task executes the logic to build a container image, tag it and push it to a local container image repository (Ex: image-registry.openshift-image-registry.svc:5000/dev-g2/dev-g-trivy6:605b0ec).\n\nHere `Buildah` tool is used to build, tag and push the the container image.  Buildah is a tool that facilitates building Open Container Initiative (OCI) container images.\n\n![Cloud-Native Toolkit Pipeline ](/images/3-task-build.png \"Cloud-Native Toolkit Pipeline\")\n\nLine no. 102: Shows buildah is login into local container registry\n\nLine no. 106: Shows buildah is pushing image to the local container registry. Given below the buildah push with variables substituted with values.\n\n```\n+ buildah --storage-driver=overlay push --tls-verify=false --digestfile ./image-digest image-registry.openshift-image-registry.svc:5000/dev-g2/dev-g-trivy6:605b0ec docker://image-registry.openshift-image-registry.svc:5000/dev-g2/dev-g-trivy6:605b0ec\n```\n\n### Task: trivy-scan \n\nTrivy-Scan task contains 2 steps. The steps are `Pull-image` and `Scan-image`. Lets see them in detail in the below sections.\n\nhttps://github.com/IBM/ibm-garage-tekton-tasks/blob/master/tasks/3-img-scan-trivy.yaml\n\n![Cloud-Native Toolkit Pipeline ](/images/4-task-scan-1.png \"Cloud-Native Toolkit Pipeline\")\n\nLine no. 29: Shows `pull-image` step\n\nLine no. 71: Shows `scan-image` step\n\n\n### Step: pull-image \n\nThis step will pull the image from the local container registry (which was built in the previous task) and store it in the OCI image directory. \n\nHere `skopeo` tool is used to the copy the image from local container registry to OCI image directory. Skopeo is a command line utility that performs various operations on container images and image repositories such as Copying an image from and to various storage mechanisms, Inspecting a remote image,  Deleting an image from an image repository and etc.\n\nThere is an option to skip this scan. When the flag `params.scan-image` is set to false then this can will be skipped.\n\n![Cloud-Native Toolkit Pipeline ](/images/5-task-scan-2.png \"Cloud-Native Toolkit Pipeline\")\n\nLine no. 70: skopeo copies the image from local container registry to OCI image directory. Given below the skopeo copy command with variables substituted with values. Here image is copied to `oci:/var/oci/image`.\n\n```\nskopeo copy --src-creds=xxxx --src-tls-verify=false docker://image-registry.openshift-image-registry.svc:5000/dev-g2/dev-g-trivy6:605b0ec oci:/var/oci/image\n```\n\n\n### Step : scan-image\n\nThis step runs an image scan with Trivy and fails the pipeline if issues are found.\n\nIn the previous step the image is copied to the OCI image directory `oci:/var/oci/image`. The variable `PATH_TO_IMAGE` would be pointing to this OCI image directory. This `PATH_TO_IMAGE` is passed to the trivy scan (line no 80 and 81). \n\nThe trivy scanning is done and `--exit-code` would be set according to the scan results. Based on the `--exit-code` pipeline will be continued or stopped.\n\n ![Cloud-Native Toolkit Pipeline ](/images/6-task-scan-3.png \"Cloud-Native Toolkit Pipeline\")\n\nLine no. 80: Trivy scan is done and it print all the vulnerabilities found in the image.\n\nLine no. 81: Trivy scan is done and it print all the CRITICAL vulnerabilities found in the image. \n\nLine no. 84: Checks if any CRITICAL vulnerabilities found, based on the `--exit-code` from line no. 81.\n\nLine no. 86: Exits the pipeline when CRITICAL vulnerabilities found.\n\n","fileAbsolutePath":"/workspace/ibm-gsi-cloudnative-journey/src/pages/developer-advanced-2/devsecops-trivy/index.mdx"}}},"staticQueryHashes":["1054721580","1054721580","1364590287","2102389209","2102389209","2456312558","2746626797","2746626797","3018647132","3018647132","3037994772","3037994772","3273249464","768070550"]}